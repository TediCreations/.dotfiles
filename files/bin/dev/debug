#!/usr/bin/env bash

#!/usr/bin/env bash

# flash

# Usage:
# $ debug -d <device>
# Example: debug -d stm32f072rb

# Get arguments
while getopts d: option
do
    case "${option}"
    in
	d) device=${OPTARG};;
    esac
done

# Check that device argument exists
if [ "${device}" == "stm32f072rb" ]; then
    echo "Flashing ${device}..."
else
    echo "Error: Device '${device}' is not supported yet!"
    exit 1
fi

# Check if jlink is installed
if ! [ -x "$(command -v JLinkGDBServerCLExe)" ]; then
  echo 'Error: JLinkGDBServerCLExe is not installed!!!' >&2
  exit 1
fi

# Program it
JLinkGDBServerCLExe -select USB -device ${device} -endian little -if SWD -speed 4000 -ir -noLocalhostOnly

exit 0
